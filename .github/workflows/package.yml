name: build custom-environment.hpi

on: [push]
jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        include:
        - { os: windows-latest, target: windows, platform: win32-x64}
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Build with Maven
    run:
      mvn package
    - name: Upload
      uses: actions/upload-artifact@v2
      with:
        name: ${{ matrix.platform }}
        path: ${{ github.workspace }}/target
  upload-release:
    name: Upload Release
    if: startsWith(github.ref, 'refs/tags/')
    needs: [build]
    runs-on: [ubuntu-18.04]
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - name: Download
        uses: actions/download-artifact@v2
      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          name: custom-environment
          draft: false
          generate_release_notes: true
          files: |
            custom-environment.hpi
          token: ${{ secrets.RELEASE }}
